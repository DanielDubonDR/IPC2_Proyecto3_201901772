{% load static %}
<!doctype html>
<html class="no-js" lang="es">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Cargar Archivo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="{% static 'assets/images/icon/favicon.ico' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome.min.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/themify-icons.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/metisMenu.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/owl.carousel.min.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/slicknav.min.css' %} ">
    <!-- amchart css -->
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <!-- others css -->
    <link rel="stylesheet" href="{% static 'assets/css/typography.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/default-css.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/styles.css' %} ">
    <link rel="stylesheet" href="{% static 'assets/css/responsive.css' %} ">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster">
    <!-- modernizr css -->
    <script src="{% static 'assets/js/vendor/modernizr-2.8.3.min.js ' %} "></script>
</head>

<body onload="CargarInfo()">
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <!-- preloader area start -->
    <div id="preloader">
        <div class="loader"></div>
    </div>
    <!-- preloader area end -->
    <!-- page container area start -->
    <div class="page-container">
        <!-- sidebar menu area start -->
        <div class="sidebar-menu">
            <div class="sidebar-header">
                <div class="logo">
                    <a href="Inicio.html"><h2 class="text-center" style="font-family: Lobster, serif;" >Post-Rest</h2></a>
                </div>
            </div>
            <div class="main-menu">
                <div class="menu-inner">
                    <nav>
                        
                        <ul class="metismenu" id="menu">
                            <li ><a href="Inicio.html"><i class="ti-receipt"></i> <span>Inicio</span></a></li>
                            <li class="active"><a href="CargarArchivo.html"><i class="ti-receipt"></i> <span>Cargar Archivo</span></a></li>
                            <li>
                                <a href="javascript:void(0)" aria-expanded="true"><i class="ti-pie-chart"></i><span>Peticiones</span></a>
                                <ul class="collapse">
                                    <li><a href="ConsultarDatos.html">Consultar datos</a></li>
                                    <li><a href="Filtro1.html">Filtrar por fecha y usuario</a></li>
                                    <li><a href="Filtro2.html">Filtrar por fecha y codigo</a></li>
                                </ul>
                            </li>
                            
                            <li>
                                <a href="javascript:void(0)" aria-expanded="true"><i class="ti-layers-alt"></i> <span>Ayuda</span></a>
                                <ul class="collapse">
                                    <li><a href="Info.html">Información del estudiante</a></li>
                                    <li><a href="Documentacion.html">Ver documentación</a></li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <!-- sidebar menu area end -->
        <!-- main content area start -->
        <div class="main-content">
            <!-- header area start -->
            <div class="header-area">
                <div class="row align-items-center">
                    <!-- nav and search button -->
                    <div class="col-md-12 col-sm-8 clearfix">
                        <div class="nav-btn pull-left">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <h6 class="page-title text-center" style="font-family: Lobster, serif;" >Post-Rest</h6>
                    </div>
                   
                </div>
            </div>
            <!-- header area end -->
            <!-- page title area start -->
            <div class="page-title-area">
                <div class="row align-items-center">
                    <div class="col-sm-6">
                        <div class="breadcrumbs-area clearfix">
                            <h4 class="page-title pull-left">Inicio</h4>
                            <ul class="breadcrumbs pull-left">
                                <li><a href="index.html">Home</a></li>
                                <li><span>Cargar Archivo</span></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-sm-6 clearfix">
                        <br> <br> <br>
                    </div>
                </div>
            </div>
            <!-- page title area end -->
            <div class="main-content-inner">
                <div class="row">
                    <!-- Bootstrap Grid start -->
                    <div class="col-12 mt-5">
                        <div class="card">
                            <div class="card-body">
                                <!-- Start 6 column grid system -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="text-primary">&nbsp;Entrada</h6>
                                        <br>
                                        <textarea class="form-control" id="contenido-archivo" aria-label="With textarea" rows="11" placeholder="Entrada"></textarea>
                                        <br>
                                        <button type="button" id="enviar" onclick="pushArchivo()" class="btn btn-success mb-3 pull-right">Enviar</button>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-primary">&nbsp;Salida</h6>
                                        <br>
                                        <textarea class="form-control" id="salida" aria-label="With textarea" rows="11" placeholder="Salida"></textarea>
                                        <br>
                                        <button type="button" class="btn btn-danger mb-3 pull-right">Reset</button>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    <div class="col-12 mt-5">
                        <div class="card">
                            <div class="card-body">
                                <div class="input-group">
                                    <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="file-input" accept=".xml">
                                    <label class="custom-file-label" for="inputGroupFile04"><h6 id="name-file" class="text-primary">Cargar Archivo</h6></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Bootstrap Grid end -->
                </div>
            </div>
            
        </div>
        <!-- main content area end -->
    </div>
    <!-- page container area end -->
    <script>
        function leerArchivo(e) {
        var archivo = e.target.files[0];
        document.getElementById('name-file').innerHTML = e.target.files[0].name;
        document.getElementById('contenido-archivo').innerHTML = "";
        if (!archivo) {
            return;
        }
        var lector = new FileReader();
        lector.onload = function(e) {
            var contenido = e.target.result;
            mostrarContenido(contenido);
        };
        lector.readAsText(archivo);
        }

        function mostrarContenido(contenido) {
        var elemento = document.getElementById('contenido-archivo');
        elemento.innerHTML = contenido;
        }

        document.getElementById('file-input').addEventListener('change', leerArchivo, false);

        function pushArchivo()
        {
            var contenido= document.querySelector('#contenido-archivo').value
            if(contenido!="")
            {
                console.log(contenido)
                fetch('http://localhost:4000/Archivo', {
                method: 'POST',
                body: contenido, 
                headers:{
                    'Content-Type': 'text/plain'
                } 
                }).then(res => res.json())
                .catch(error => {
                    console.error('Error:', error)
                    alert("Ocurrio un error")
                })
                .then(response =>{
                    console.log('Success:', response);
                    alert("Se recibió el archivo exitosamente")
                    VerInfo()
                    //location.reload
                    //location.href="/perfil"
                }) 
            }
            else{
                alert('Llene todos los campos')
            }
        }
        
        function VerInfo()
        {
            fetch(`http://localhost:4000/VerArchivo`)
            .then(response => response.text())
          .catch(error => {
            console.log(error)
          })
          .then(res =>{
            //console.log(res)
            document.querySelector('#salida').value = res
          })
        }
        /*
        function CargarInfo()
        {
            fetch(`http://localhost:4000/VerArchivo`)
            .then(response => response.text())
          .catch(error => {
            console.log(error)
          })
          .then(res =>{
            //console.log(res)
            document.querySelector('#contenido-archivo').value = res
          })
        }*/
    </script>
    <!-- jquery latest version -->
    <script src="{% static 'assets/js/vendor/jquery-2.2.4.min.js' %} "></script>
    <!-- bootstrap 4 js -->
    <script src="{% static 'assets/js/popper.min.js' %} "></script>
    <script src="{% static 'assets/js/bootstrap.min.js' %} "></script>
    <script src="{% static 'assets/js/owl.carousel.min.js' %} "></script>
    <script src="{% static 'assets/js/metisMenu.min.js' %} "></script>
    <script src="{% static 'assets/js/jquery.slimscroll.min.js' %} "></script>
    <script src="{% static 'assets/js/jquery.slicknav.min.js' %} "></script>

    <!-- start chart js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <!-- start highcharts js -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <!-- start zingchart js -->
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script>
    zingchart.MODULESDIR = "https://cdn.zingchart.com/modules/";
    ZC.LICENSE = ["569d52cefae586f634c54f86dc99e6a9", "ee6b7db5b51705a13dc2339db3edaf6d"];
    </script>
    <!-- others plugins -->
    <script src="{% static 'assets/js/plugins.js' %} "></script>
    <script src="{% static 'assets/js/scripts.js' %} "></script>
</body>

</html>